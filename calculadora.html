<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Calculadora + Tetris 12x20 + Pong</title>
<style>
:root{--bg1:#eaf2ff;--bg2:#d6ffd9}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
  background: linear-gradient(135deg,var(--bg1),var(--bg2));
  min-height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:20px;
}
.app { display:flex; gap:36px; align-items:flex-start; flex-wrap:wrap; }

/* Calculadora */
.calc {
  background:#fff; color:#000; border-radius:12px; padding:18px;
  box-shadow:0 6px 20px rgba(0,0,0,0.12); width:240px;
}
.calc h2{ margin:0 0 10px 0; font-size:18px }
#display{
  width:100%; height:44px; border-radius:8px; border:1px solid #ccc;
  padding:6px 10px; font-size:20px; text-align:right; margin-bottom:10px;
  background:white; color:black;
}
.keys { display:grid; grid-template-columns:repeat(4,1fr); gap:8px; }
.key {
  height:44px; border-radius:8px; border:none; background:#222; color:#fff;
  font-size:18px; cursor:pointer;
}
.key.operator { background:#444; }
.actions { margin-top:12px; display:flex; gap:8px; flex-wrap:wrap; }
.btn {
  flex:1; padding:8px 10px; border-radius:8px; border:none;
  background:royalblue; color:white; cursor:pointer;
}
.btn.secondary { background:darkorange }

/* Tetris */
.tetris { display:flex; flex-direction:column; align-items:center; gap:8px; }
.tetris h2{ margin:0; color:#000 }
#tetrisCanvas {
  display:block; background:#111; border-radius:8px;
  box-shadow:0 6px 20px rgba(0,0,0,0.2);
}
.score { color:#000; font-weight:600; }
.controls { margin-top:6px; font-size:13px; color:#111; text-align:center; background:rgba(255,255,255,0.6); padding:6px 10px; border-radius:6px; }
</style>
</head>
<body>
<div class="app">
  <!-- Calculadora -->
  <div class="calc" aria-label="Calculadora">
    <h2>Calculadora</h2>
    <div id="display" aria-live="polite"></div>
    <div class="keys">
      <button class="key" onclick="press('7')">7</button>
      <button class="key" onclick="press('8')">8</button>
      <button class="key" onclick="press('9')">9</button>
      <button class="key operator" onclick="press('/')">/</button>

      <button class="key" onclick="press('4')">4</button>
      <button class="key" onclick="press('5')">5</button>
      <button class="key" onclick="press('6')">6</button>
      <button class="key operator" onclick="press('*')">*</button>

      <button class="key" onclick="press('1')">1</button>
      <button class="key" onclick="press('2')">2</button>
      <button class="key" onclick="press('3')">3</button>
      <button class="key operator" onclick="press('-')">-</button>

      <button class="key" onclick="press('0')" style="grid-column:span 2">0</button>
      <button class="key" onclick="press('.')">.</button>
      <button class="key operator" onclick="calculate()">=</button>
    </div>
    <div class="actions">
      <button class="btn" onclick="clearDisplay()">C</button>
      <button class="btn" onclick="backspace()">⌫</button>
      <button class="btn secondary" onclick="toggleTetris()">Abrir/Fechar Tetris</button>
      <button class="btn" onclick="openPongWindow()">Jogar Pong (nova janela)</button>
    </div>
  </div>

  <!-- Tetris -->
  <div class="tetris" id="tetrisBlock">
    <h2>Tetris 12×20</h2>
    <canvas id="tetrisCanvas" width="288" height="480" aria-label="Área do tetris"></canvas>
    <div class="score">Pontuação: <span id="tetrisScore">0</span></div>
    <div class="controls">Controles: W = Girar | A = ← | D = → | S = ↓</div>
  </div>
</div>

<script>
/* -------------------- Calculadora -------------------- */
const display = document.getElementById('display');
function press(v){ display.innerText += v; }
function clearDisplay(){ display.innerText = ''; }
function backspace(){ display.innerText = display.innerText.slice(0,-1); }
function calculate(){
  try {
    const r = eval(display.innerText || '');
    display.innerText = (r === undefined ? '' : String(r));
  } catch(e){
    display.innerText = 'Erro';
  }
}

/* -------------------- Tetris 12x20 -------------------- */
const COLS = 12, ROWS = 20, CELL = 24;
const canvas = document.getElementById('tetrisCanvas');
const ctx = canvas.getContext('2d');
const scoreElem = document.getElementById('tetrisScore');
let arena = createMatrix(COLS, ROWS);
let player = createPlayer();
let lastTime = 0;
let dropCounter = 0;
let dropInterval = 800;
let tetrisAnimId = null;
let keyHandlerRef = null;
let score = 0;
let tetrisVisible = true;

const COLORS = [null,'#915cbe','#f1c40f','#e74c3c','#1abc9c','#3498db','#ff8c42','#7f8c8d'];

function createMatrix(w,h){ return Array.from({length:h},()=>Array(w).fill(0)); }
function createPiece(type){
  switch(type){
    case 'T': return [[0,1,0],[1,1,1],[0,0,0]];
    case 'O': return [[2,2],[2,2]];
    case 'L': return [[0,0,3],[3,3,3],[0,0,0]];
    case 'J': return [[4,0,0],[4,4,4],[0,0,0]];
    case 'I': return [[0,5,0,0],[0,5,0,0],[0,5,0,0],[0,5,0,0]];
    case 'S': return [[0,6,6],[6,6,0],[0,0,0]];
    case 'Z': return [[7,7,0],[0,7,7],[0,0,0]];
  }
}
function createPlayer(){ return {pos:{x:0,y:0}, matrix:createPiece(randomPiece())}; }
function randomPiece(){ const arr=['T','O','L','J','I','S','Z']; return arr[Math.floor(Math.random()*arr.length)]; }
function rotateMatrix(m, dir){
  for(let y=0;y<m.length;y++) for(let x=0;x<y;x++) [m[x][y], m[y][x]]=[m[y][x], m[x][y]];
  if(dir>0) m.forEach(r=>r.reverse()); else m.reverse();
}
function collide(arena, player){
  const m=player.matrix, o=player.pos;
  for(let y=0;y<m.length;y++) for(let x=0;x<m[y].length;x++){
    if(m[y][x]!==0){
      const ax=o.x+x, ay=o.y+y;
      if(ax<0||ax>=COLS||ay>=ROWS) return true;
      if(ay<0) continue;
      if(arena[ay][ax]!==0) return true;
    }
  }
  return false;
}
function merge(arena, player){
  player.matrix.forEach((row,y)=>row.forEach((val,x)=>{
    if(val!==0){ const ay=player.pos.y+y, ax=player.pos.x+x; if(ay>=0&&ay<ROWS&&ax>=0&&ax<COLS) arena[ay][ax]=val; }
  }));
}
function arenaSweep(){
  let rowCount=0;
  outer: for(let y=ROWS-1;y>=0;y--){
    for(let x=0;x<COLS;x++) if(arena[y][x]===0) continue outer;
    arena.splice(y,1); arena.unshift(Array(COLS).fill(0)); y++; rowCount++;
  }
  if(rowCount>0){ score+=rowCount*10; scoreElem.innerText=score; }
}
function drawCell(x,y,color){
  ctx.fillStyle=color; ctx.fillRect(x*CELL,y*CELL,CELL,CELL);
  ctx.strokeStyle='#080808'; ctx.lineWidth=1; ctx.strokeRect(x*CELL+0.5,y*CELL+0.5,CELL-1,CELL-1);
}
function drawMatrix(matrix, offset){ matrix.forEach((row,y)=>row.forEach((val,x)=>{ if(val!==0) drawCell(offset.x+x,offset.y+y,COLORS[val]); })); }
function draw(){
  ctx.fillStyle='#111'; ctx.fillRect(0,0,canvas.width,canvas.height);
  for(let y=0;y<ROWS;y++) for(let x=0;x<COLS;x++) if(arena[y][x]!==0) drawCell(x,y,COLORS[arena[y][x]]);
  drawMatrix(player.matrix, player.pos);
}
function playerDrop(){
  player.pos.y++; if(collide(arena,player)){ player.pos.y--; merge(arena,player); resetPlayer(); arenaSweep(); }
  dropCounter=0;
}
function playerMove(dir){ player.pos.x+=dir; if(collide(arena,player)) player.pos.x-=dir; }
function playerRotate(dir){
  const cloned=player.matrix.map(r=>r.slice());
  rotateMatrix(cloned,dir);
  const oldX=player.pos.x;
  let offset=1;
  while(collidePos(cloned,player.pos.x,player.pos.y)){ player.pos.x+=offset; offset=-(offset+(offset>0?1:-1)); if(Math.abs(offset)>COLS){ player.pos.x=oldX; return; } }
  player.matrix=cloned;
}
function collidePos(mat,posX,posY){
  for(let y=0;y<mat.length;y++) for(let x=0;x<mat[y].length;x++){
    if(mat[y][x]!==0){
      const ax=posX+x, ay=posY+y;
      if(ax<0||ax>=COLS||ay>=ROWS) return true;
      if(ay<0) continue;
      if(arena[ay][ax]!==0) return true;
    }
  }
  return false;
}
function resetPlayer(){
  const type=randomPiece();
  player.matrix=createPiece(type);
  player.pos.y=-1;
  player.pos.x=Math.floor((COLS-player.matrix[0].length)/2);
  if(collide(arena,player)){ arena=createMatrix(COLS,ROWS); score=0; scoreElem.innerText=score; }
}
function update(time=0){
  const delta=time-lastTime; lastTime=time;
  dropCounter+=delta; if(dropCounter>dropInterval) playerDrop();
  draw();
  tetrisAnimId=requestAnimationFrame(update);
}
function attachTetrisKeys(){
  if(keyHandlerRef) document.removeEventListener('keydown',keyHandlerRef);
  keyHandlerRef=function(e){
    if(e.key=='a'||e.key=='A'||e.key=='ArrowLeft') playerMove(-1);
    else if(e.key=='d'||e.key=='D'||e.key=='ArrowRight') playerMove(1);
    else if(e.key=='s'||e.key=='S'||e.key=='ArrowDown') playerDrop();
    else if(e.key=='w'||e.key=='W'||e.key=='ArrowUp') playerRotate(1);
  };
  document.addEventListener('keydown',keyHandlerRef);
}
function startTetris(){ if(tetrisAnimId) cancelAnimationFrame(tetrisAnimId); arena=createMatrix(COLS,ROWS); player=createPlayer(); resetPlayer(); score=0; scoreElem.innerText=score; dropCounter=0; lastTime=0; attachTetrisKeys(); draw(); tetrisAnimId=requestAnimationFrame(update); }
function toggleTetris(){
  const block=document.getElementById('tetrisBlock'); tetrisVisible=!tetrisVisible; block.style.display=tetrisVisible?'flex':'none';
  if(tetrisVisible) startTetris(); else { if(tetrisAnimId) cancelAnimationFrame(tetrisAnimId); if(keyHandlerRef){ document.removeEventListener('keydown',keyHandlerRef); keyHandlerRef=null; } }
}
startTetris();

/* -------------------- Pong (nova janela) -------------------- */
function openPongWindow(){
  const pongHtml=`<!doctype html>
  <html>
  <head>
    <meta charset="utf-8">
    <title>Pong</title>
    <style>
      body{margin:0;background:#000;display:flex;align-items:center;justify-content:center;height:100vh;color:#fff;font-family:Arial;}
      canvas{background:#000;border:3px solid #fff;border-radius:8px}
      .hint{position:fixed;top:12px;left:12px;color:#fff;opacity:0.9}
    </style>
  </head>
  <body>
    <div class="hint">W / S para mover</div>
    <canvas id="pong" width="500" height="340"></canvas>
    <script>
      const canvas=document.getElementById('pong');
      const ctx=canvas.getContext('2d');
      const paddleWidth=12, paddleHeight=80;
      let player={x:12,y:canvas.height/2 - paddleHeight/2,dy:0,speed:6,score:0};
      let computer={x:canvas.width-12-paddleWidth,y:canvas.height/2 - paddleHeight/2,score:0};
      let ball={x:canvas.width/2,y:canvas.height/2,radius:8,speed:5,velX:5,velY:3};
      let keys={};
      window.addEventListener('keydown',e=>keys[e.key.toLowerCase()]=true);
      window.addEventListener('keyup',e=>keys[e.key.toLowerCase()]=false);

      function drawRect(x,y,w,h,c){ctx.fillStyle=c;ctx.fillRect(x,y,w,h);}
      function drawCircle(x,y,r,c){ctx.fillStyle=c;ctx.beginPath();ctx.arc(x,y,r,0,Math.PI*2);ctx.fill();}
      function drawText(t,x,y){ctx.fillStyle='#fff';ctx.font='24px Arial';ctx.fillText(t,x,y);}
      function resetBall(){ ball.x=canvas.width/2; ball.y=canvas.height/2; ball.speed=5; ball.velX=(Math.random()>0.5?1:-1)*5; ball.velY=(Math.random()*4-2);}
      function collision(b,p){ return b.x-b.radius<p.x+paddleWidth && b.x+b.radius>p.x && b.y-b.radius<p.y+paddleHeight && b.y+b.radius>p.y; }

      function update(){
        // player
        player.dy=0;
        if(keys['w']) player.dy=-player.speed;
        if(keys['s']) player.dy=player.speed;
        player.y+=player.dy;
        if(player.y<0) player.y=0;
        if(player.y+paddleHeight>canvas.height) player.y=canvas.height-paddleHeight;

        // AI
        if(ball.y < computer.y + paddleHeight/2) computer.y -= 4;
        else computer.y += 4;
        if(computer.y <0) computer.y=0;
        if(computer.y+paddleHeight>canvas.height) computer.y=canvas.height-paddleHeight;

        // ball
        ball.x+=ball.velX; ball.y+=ball.velY;
        if(ball.y-ball.radius<0 || ball.y+ball.radius>canvas.height) ball.velY*=-1;

        let p = ball.x < canvas.width/2 ? player : computer;
        if(collision(ball,p)){
          let collidePoint=(ball.y-(p.y+paddleHeight/2))/(paddleHeight/2);
          let angle=collidePoint*(Math.PI/4);
          let dir= ball.x<canvas.width/2?1:-1;
          ball.velX=dir*ball.speed*Math.cos(angle);
          ball.velY=ball.speed*Math.sin(angle);
          ball.speed+=0.5;
        }

        if(ball.x-ball.radius<0){ computer.score++; resetBall(); }
        else if(ball.x+ball.radius>canvas.width){ player.score++; resetBall(); }
      }

      function render(){
        ctx.fillStyle='#000'; ctx.fillRect(0,0,canvas.width,canvas.height);
        drawRect(player.x,player.y,paddleWidth,paddleHeight,'#fff');
        drawRect(computer.x,computer.y,paddleWidth,paddleHeight,'#fff');
        drawCircle(ball.x,ball.y,ball.radius,'#fff');
        drawText(player.score,canvas.width*0.25,30);
        drawText(computer.score,canvas.width*0.75,30);
      }

      function loop(){ update(); render(); requestAnimationFrame(loop); }
      loop();
    <\/script>
  </body>
  </html>`;

  const w=window.open('','_blank','width=560,height=460');
  if(!w){ alert('Pop-up bloqueado. Permita pop-ups para abrir o Pong.'); return; }
  w.document.open(); w.document.write(pongHtml); w.document.close(); w.focus();
}
</script>
</body>
</html>
